# PayPal API


## How we use the PayPal API
The `PayPalAPIUrlGenerator` makes a request to the PayPal REST API to "announce" a payment to PayPal.
PayPal answers with a URL to send the user to, where the user can then log in to PayPal and confirm the payment.

In order for the `PayPalAPIUrlGenerator` to send a request to do a recurring payment, 
we need to pass the ID of a so-called "subscription plan". A subscription plan consists of 

- a name (shown in the PayPal web UI)
- an ID (generated by PayPal)
- a product ID (provided by us, see "Configuration" below)
- a payment interval (monthly, quarterly, half-yearly, yearly)

The subscription plans need to be set up once. In order to set them up, you need a configuration file (see "Configuration" below) and then use the command `create-subscription-plans` to do special API calls that create the plans (see below).

One-time-payments use a different API endpoint and no subscription plans.
We abstracted this behavior in `PayPalAPIUrlGenerator`, which will examine each payment and call the appropriate API endpoint.

## Providing API credentials
The commands that communicate with the PayPal API need credentials. Regardless if you use the standalone `bin/console` in this bounded context or the `bin/console` in the [Fundraising Application](https://github.com/wmde/fundraising-application), the format of the credentials file is the same:

```
# URL of the paypal API v1 endpoint
PAYPAL_API_URL="https://api-m.sandbox.paypal.com/"

# See https://developer.paypal.com/api/rest/authentication/
PAYPAL_API_CLIENT_ID="something"
PAYPAL_API_CLIENT_SECRET="n0ts0s3cr1t"
```

Put these key-value-pairs in a file called `.env`, either in the directory of this bounded context or in the directory of the Fundraising application.

The `.env` files should be part of the deployment, as different environments will have different credentials and URLs (sandbox vs. no sandbox). For development and testing purposes you can create an `.env` file in this bounded context. 

DOT NOT PUT THE `.env` FILE IN THE GIT REPOSITORY!


## TODO

- preparing the config file
  - preparing for running the commands (plan names and intervals)
  - preparing for using in the application (adding actual IDs to the plans)
- running the command for creating subscription plans
- listing the subscription plans
